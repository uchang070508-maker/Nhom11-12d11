<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B·∫£n ƒë·ªì c√°c c·∫ßu </title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>

<style>
#map {
    height: 650px;
    max-width: 1200px;
    margin: 30px auto;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.map-controls{
    max-width: 1200px;
    margin: auto;
    text-align:center;
    padding:20px;
    background:white;
    border-radius:15px;
    box-shadow:0 8px 20px rgba(0,0,0,0.1);
}

.map-controls select{
    padding:10px 15px;
    border-radius:10px;
    margin:5px;
    border:1px solid #ccc;
}

.map-controls button{
    padding:10px 20px;
    margin:5px;
    border:none;
    border-radius:25px;
    background:linear-gradient(135deg,#1565c0,#1e88e5);
    color:white;
    cursor:pointer;
    transition:0.3s;
}

.map-controls button:hover{
    transform:translateY(-3px);
    box-shadow:0 8px 20px rgba(21,101,192,0.4);
}
</style>
</head>
<body>

<header>
    <div class="logo-box">
  <img src="logo.png" alt="Logo Tr∆∞·ªùng">
  <span class="school-name">Tr·ª´·ªùng THPT Phan Li√™m</span>
</div>
<h1>B·∫£n ƒë·ªì c√°c c√¢y c·∫ßu </h1>
</header>
<nav>
    <a href="index.html">Trang ch·ªß</a>
    <a href="about.html">Gi·ªõi thi·ªáu</a>
    <a href="list.html">Danh s√°ch c·∫ßu</a>
    <a href="compare.html">So s√°nh</a>
    <a href="timeline.html">L·ªãch s·ª≠</a>
    <a href="gallery.html">Gallery</a>
    <a href="map.html">B·∫£n ƒë·ªì</a>
    <a href="education.html">Gi√°o d·ª•c</a>
    <a href="contact.html">Li√™n h·ªá</a>
</nav>
<div class="toggle-theme" onclick="toggleTheme()">‚òÄÔ∏è</div>
<audio id="bgMusic" loop>
  <source src="cau.mp3" type="audio/mpeg">
</audio>

<div class="music-toggle" onclick="toggleMusic()">üéµ</div>

<div id="map"></div>

<div class="map-controls">
    <select id="bridge1"></select>
    <select id="bridge2"></select>
    <button onclick="calculateDistance()">T√≠nh kho·∫£ng c√°ch</button>
    <button onclick="drawRoute()">V·∫Ω h√†nh tr√¨nh</button>
    <button onclick="resetRoute()">Reset</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<script>

// MAP INIT
var map = L.map('map',{zoomControl:false}).setView([10.85,106.85],9);
L.control.zoom({position:'topright'}).addTo(map);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap'
}).addTo(map);

// ICON RI√äNG
var bridgeIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
    iconSize: [35,35]
});

// 8 C·∫¶U
const bridges = [
{name:"C·∫ßu M·ªπ Thu·∫≠n", river:"S√¥ng Ti·ªÅn", coords:[10.2700,105.9300]},
{name:"C·∫ßu R·∫°ch Mi·ªÖu", river:"S√¥ng Ti·ªÅn", coords:[10.2560,106.3630]},
{name:"C·∫ßu C·ªï Chi√™n", river:"S√¥ng C·ªï Chi√™n", coords:[9.9330,106.3500]},
{name:"C·∫ßu H√†m Lu√¥ng", river:"S√¥ng H√†m Lu√¥ng", coords:[10.2410,106.3750]},
{name:"C·∫ßu An H√≥a", river:"K√™nh Giao H√≤a", coords:[10.3500,106.3000]},
{name:"C·∫ßu C√°i Cam", river:"S√¥ng C√°i Cam", coords:[10.2520,105.9700]},
{name:"C·∫ßu L√°ng Chim", river:"-", coords:[9.6200,106.5200]},
{name:"C·∫ßu ƒê√¨nh Khao", river:"S√¥ng C·ªï Chi√™n", coords:[10.1500,106.2800]}
];

// MARKER
bridges.forEach(b=>{
    L.marker(b.coords,{icon:bridgeIcon})
    .addTo(map)
    .bindPopup(`
        <b style="font-size:16px">${b.name}</b>
        <br>B·∫Øc qua: ${b.river}
    `);
});

// DROPDOWN
const select1=document.getElementById("bridge1");
const select2=document.getElementById("bridge2");

bridges.forEach((b,i)=>{
    select1.innerHTML+=`<option value="${i}">${b.name}</option>`;
    select2.innerHTML+=`<option value="${i}">${b.name}</option>`;
});

let routingControl;
let distanceLine;

// T√çNH KHO·∫¢NG C√ÅCH
function calculateDistance(){
    let i1=select1.value;
    let i2=select2.value;

    if(i1===i2){
        alert("Ch·ªçn 2 c·∫ßu kh√°c nhau!");
        return;
    }

    let p1=L.latLng(bridges[i1].coords);
    let p2=L.latLng(bridges[i2].coords);

    let distance=p1.distanceTo(p2)/1000;

    if(distanceLine){
        map.removeLayer(distanceLine);
    }

    distanceLine=L.polyline([p1,p2],{
        color:'#e53935',
        dashArray:'6'
    }).addTo(map);

    distanceLine.bindTooltip(
        "Kho·∫£ng c√°ch: "+distance.toFixed(2)+" km",
        {permanent:true, direction:'center'}
    ).openTooltip();

    map.fitBounds(distanceLine.getBounds());
}

// V·∫º TUY·∫æN ƒê∆Ø·ªúNG
function drawRoute(){

    let i1=select1.value;
    let i2=select2.value;

    if(i1===i2){
        alert("Ch·ªçn 2 c·∫ßu kh√°c nhau!");
        return;
    }

    if(routingControl){
        map.removeControl(routingControl);
    }

    routingControl=L.Routing.control({
        waypoints:[
            L.latLng(bridges[i1].coords),
            L.latLng(bridges[i2].coords)
        ],
        routeWhileDragging:false,
        lineOptions:{
            styles:[{color:'#1565c0',weight:6}]
        }
    }).addTo(map);
}

// RESET
function resetRoute(){
    if(routingControl){
        map.removeControl(routingControl);
    }
    if(distanceLine){
        map.removeLayer(distanceLine);
    }
    map.setView([10.85,106.85],9);
}

</script>
    <script>
function toggleTheme() {
  document.body.classList.toggle("dark");

  const btn = document.querySelector(".toggle-theme");

  if (document.body.classList.contains("dark")) {
    btn.textContent = "‚òÄÔ∏è";
    localStorage.setItem("theme", "dark");
  } else {
    btn.textContent = "üåô";
    localStorage.setItem("theme", "light");
  }
}

window.onload = function () {
  const btn = document.querySelector(".toggle-theme");

  if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark");
    btn.textContent = "‚òÄÔ∏è";
  } else {
    btn.textContent = "üåô";
  }
};
</script>

<script>
const bgMusic = document.getElementById("bgMusic");
const musicBtn = document.querySelector(".music-toggle");

let musicOn = localStorage.getItem("music") !== "off";

window.addEventListener("load", () => {
  if (musicOn) {
    bgMusic.volume = 0.4;
    bgMusic.play().catch(()=>{});
  } else {
    musicBtn.classList.add("off");
    musicBtn.textContent = "üîá";
  }
});

function toggleMusic() {
  musicOn = !musicOn;
  if (musicOn) {
    bgMusic.play();
    musicBtn.textContent = "üéµ";
    musicBtn.classList.remove("off");
    localStorage.setItem("music", "on");
  } else {
    bgMusic.pause();
    musicBtn.textContent = "üîá";
    musicBtn.classList.add("off");
    localStorage.setItem("music", "off");
  }
}
</script>

<button id="topBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">
  ‚Üë
</button>

</body>
</html>
